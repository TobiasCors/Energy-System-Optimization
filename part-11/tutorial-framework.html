<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.41">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Tobias Cors">

<title>Tutorial XI - Multi-Energy System Optimization Framework – Energy System Optimization with Julia</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-48ffa3e5b9d089919c6712c39e5b00f2.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-535f1e98bdee6bd367c8658371e9dbec.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script defer="" data-domain="TobiasCors.github.io/energy-system-optimization" src="https://plausible.io/js/script.file-downloads.outbound-links.js"></script>
<script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Tutorial XI - Multi-Energy System Optimization Framework</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="https://images.unsplash.com/photo-1617228679684-890412dc57a5?q=80&amp;w=3270&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.0.3&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../general/syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
 <span class="menu-text">***</span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-01/lecture-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">01 Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">02 First Steps</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-02/lecture-firststeps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-02/tutorial-02-01-variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">01 - Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-02/tutorial-02-02-vectors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02 - Vectors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-02/tutorial-02-03-comparisons.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">03 - Comparisons</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-02/tutorial-02-04-loops.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">04 - Loops</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-02/tutorial-02-05-dicts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">05 - Dictionaries</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">03 Data</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-03/lecture-packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-03/tutorial-03-01-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">01 - Functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-03/tutorial-03-02-handling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02 - Packages</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-03/tutorial-03-03-DataFrames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">03 - DataFrames</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-03/tutorial-03-04-IO.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">04 - Input and Output</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-03/tutorial-03-05-Plotting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">05 - Plotting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">04 Optimization</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-04/lecture-jump.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-04/tutorial-04-01-jump.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">01 - JuMP</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-04/tutorial-04-02-bounds.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02 - Bounds</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-04/tutorial-04-03-constraints.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">03 - Constraints</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-04/tutorial-04-04-advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">04 - Advanced</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-04/tutorial-04-05-transport.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">05 - Transport</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">05 Dispatch</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-05/lecture-dispatch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-05/tutorial-dispatch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">06 Commitment</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-06/lecture-commitment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-06/tutorial-commitment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">07 Storage</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-07/lecture-storage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-07/tutorial-storage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false">
 <span class="menu-text">08 Design</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-08/lecture-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-08/tutorial-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false">
 <span class="menu-text">09 MES</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-09/lecture-mes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false">
 <span class="menu-text">10 Intermission</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-10/lecture-intermission.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false">
 <span class="menu-text">11 Framework</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-11/lecture-framework.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false">
 <span class="menu-text">12 Repetition</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-12/lecture-repetition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">***</span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false">
 <span class="menu-text">Cheatsheets</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../general/cheatsheet-julia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Julia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../general/cheatsheet-jump.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">JuMP</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../general/faq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FAQs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../general/literature.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Literature</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#general-multi-energy-system-framework" id="toc-general-multi-energy-system-framework" class="nav-link active" data-scroll-target="#general-multi-energy-system-framework"><span class="flow">General Multi-Energy System Framework</span></a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#mathematical-framework-overview" id="toc-mathematical-framework-overview" class="nav-link" data-scroll-target="#mathematical-framework-overview">Mathematical Framework Overview</a>
  <ul class="collapse">
  <li><a href="#sets" id="toc-sets" class="nav-link" data-scroll-target="#sets">Sets</a></li>
  <li><a href="#variables" id="toc-variables" class="nav-link" data-scroll-target="#variables">Variables</a></li>
  <li><a href="#parameters" id="toc-parameters" class="nav-link" data-scroll-target="#parameters">Parameters</a></li>
  <li><a href="#objective" id="toc-objective" class="nav-link" data-scroll-target="#objective">Objective</a></li>
  <li><a href="#key-constraints" id="toc-key-constraints" class="nav-link" data-scroll-target="#key-constraints">Key Constraints</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#data-generation-and-model-implementation" id="toc-data-generation-and-model-implementation" class="nav-link" data-scroll-target="#data-generation-and-model-implementation"><span class="flow">Data Generation and Model Implementation</span></a>
  <ul class="collapse">
  <li><a href="#load-packages" id="toc-load-packages" class="nav-link" data-scroll-target="#load-packages">1. Load Packages</a></li>
  <li><a href="#data-generation" id="toc-data-generation" class="nav-link" data-scroll-target="#data-generation">2. Data Generation</a></li>
  <li><a href="#load-and-process-data" id="toc-load-and-process-data" class="nav-link" data-scroll-target="#load-and-process-data">3. Load and Process Data</a></li>
  <li><a href="#model-implementation" id="toc-model-implementation" class="nav-link" data-scroll-target="#model-implementation">4. Model Implementation</a></li>
  <li><a href="#solve-and-analyze-results" id="toc-solve-and-analyze-results" class="nav-link" data-scroll-target="#solve-and-analyze-results">5. Solve and Analyze Results</a></li>
  <li><a href="#create-figures" id="toc-create-figures" class="nav-link" data-scroll-target="#create-figures">6. Create Figures</a></li>
  <li><a href="#methanol-synthesis-and-carbon-capture-extension" id="toc-methanol-synthesis-and-carbon-capture-extension" class="nav-link" data-scroll-target="#methanol-synthesis-and-carbon-capture-extension">7. Methanol Synthesis and Carbon Capture Extension</a></li>
  <li><a href="#sensitivity-analysis" id="toc-sensitivity-analysis" class="nav-link" data-scroll-target="#sensitivity-analysis">8. Sensitivity Analysis</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">9. Conclusion</a>
  <ul class="collapse">
  <li><a href="#framework-implementation" id="toc-framework-implementation" class="nav-link" data-scroll-target="#framework-implementation">Framework Implementation</a></li>
  <li><a href="#system-extension" id="toc-system-extension" class="nav-link" data-scroll-target="#system-extension">System Extension</a></li>
  <li><a href="#key-benefits" id="toc-key-benefits" class="nav-link" data-scroll-target="#key-benefits">Key Benefits</a></li>
  <li><a href="#practical-applications" id="toc-practical-applications" class="nav-link" data-scroll-target="#practical-applications">Practical Applications</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#solutions" id="toc-solutions" class="nav-link" data-scroll-target="#solutions">Solutions</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TobiasCors/Energy-System-Optimization/edit/main/part-11/tutorial-framework.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TobiasCors/Energy-System-Optimization/blob/main/part-11/tutorial-framework.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/TobiasCors/Energy-System-Optimization/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="tutorial-framework.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="tutorial-framework.ipynb" download="tutorial-framework.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tutorial XI - Multi-Energy System Optimization Framework</h1>
<p class="subtitle lead">Energy System Optimization with Julia</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Dr.&nbsp;Tobias Cors </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Hamburg University of Applied Science - Summer 2025
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<section id="general-multi-energy-system-framework" class="level1 title">
<h1 class="title"><span class="flow">General Multi-Energy System Framework</span></h1>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This tutorial demonstrates the implementation of a <strong>general multi-energy system optimization framework</strong> in Julia, following the mathematical formulation from the lecture. The framework is designed to be technology-agnostic and flexible, allowing you to model and optimize energy systems with multiple energy carriers (e.g., electricity, hydrogen, heat, methanol, CO₂, etc.) and a wide range of conversion, storage, and supply technologies.</p>
<p>The model is structured to: - Optimize investment and operational decisions across all technologies and carriers - Allow easy extension to new technologies and energy carriers by changing sets and parameters - Enable robust planning under uncertainty via scenario-based stochastic optimization</p>
<p>In this tutorial, you will: - Build the general sets and parameters for the framework - Generate example data for a multi-carrier system - Implement the model in Julia using JuMP - Extend the system with a methanol synthesis plant and a carbon capture unit</p>
</section>
<section id="mathematical-framework-overview" class="level2">
<h2 class="anchored" data-anchor-id="mathematical-framework-overview">Mathematical Framework Overview</h2>
<section id="sets" class="level3">
<h3 class="anchored" data-anchor-id="sets">Sets</h3>
<ul>
<li><span class="math inline">\(\mathcal{T}\)</span>: Time periods</li>
<li><span class="math inline">\(\mathcal{E}\)</span>: Energy carriers/fuels (e.g., electricity, hydrogen, CO₂, methanol)</li>
<li><span class="math inline">\(\mathcal{E}^D\)</span>: Subset of carriers with demand constraints</li>
<li><span class="math inline">\(\mathcal{G}\)</span>: All technology units</li>
<li><span class="math inline">\(\mathcal{G}^S\)</span>: Storage units</li>
<li><span class="math inline">\(\mathcal{G}^{Var}\)</span>: Variable renewable units (e.g., wind, PV)</li>
<li><span class="math inline">\(\mathcal{G}^{Conv}\)</span>: Conversion units (e.g., electrolyzer, methanol synthesis)</li>
<li><span class="math inline">\(\mathcal{G}^{Sup}\)</span>: Supply units (e.g., grid, CO₂ supply)</li>
<li><span class="math inline">\(\Omega\)</span>: Scenarios</li>
</ul>
</section>
<section id="variables" class="level3">
<h3 class="anchored" data-anchor-id="variables">Variables</h3>
<ul>
<li><strong>Investment</strong>: <span class="math inline">\(P_g^{nom}\)</span> (nominal capacity), <span class="math inline">\(SOC_g^{nom}\)</span> (storage energy capacity)</li>
<li><strong>Operation</strong>: <span class="math inline">\(x_{g,e,t,\omega}^{in}\)</span> (input flow), <span class="math inline">\(x_{g,e,t,\omega}^{out}\)</span> (output flow), <span class="math inline">\(x_{g,t,\omega}^{total}\)</span> (activity), <span class="math inline">\(soc_{g,t,\omega}\)</span> (state of charge), <span class="math inline">\(f_{e,t,\omega}^{buy}\)</span>, <span class="math inline">\(f_{e,t,\omega}^{sell}\)</span></li>
<li><strong>Binary</strong>: <span class="math inline">\(u_{g,t,\omega}\)</span> (on/off), <span class="math inline">\(o_{g,t,\omega}\)</span> (charge/discharge)</li>
</ul>
</section>
<section id="parameters" class="level3">
<h3 class="anchored" data-anchor-id="parameters">Parameters</h3>
<ul>
<li><strong>Costs</strong>: Investment, variable, startup</li>
<li><strong>Conversion</strong>: <span class="math inline">\(\sigma_{g,e}^{in}\)</span>, <span class="math inline">\(\sigma_{g,e}^{out}\)</span>, <span class="math inline">\(\Theta_g\)</span></li>
<li><strong>Limits</strong>: <span class="math inline">\(P_g^{max}\)</span>, <span class="math inline">\(P_g^{min}\)</span>, <span class="math inline">\(SOC_g^{max}\)</span>, etc.</li>
<li><strong>Scenario data</strong>: Demand, prices, capacity factors, etc.</li>
</ul>
</section>
<section id="objective" class="level3">
<h3 class="anchored" data-anchor-id="objective">Objective</h3>
<p>Maximize profit (revenues from selling carriers minus costs for buying, variable costs, startup costs, and investment costs).</p>
</section>
<section id="key-constraints" class="level3">
<h3 class="anchored" data-anchor-id="key-constraints">Key Constraints</h3>
<ul>
<li>Investment cost and budget</li>
<li>Input-output relationships for all technologies</li>
<li>Storage dynamics</li>
<li>Energy carrier balances for all <span class="math inline">\(e\)</span></li>
<li>Technology and storage capacity limits</li>
<li>(Optional) Unit commitment and startup costs</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This framework is highly flexible: to add a new technology or carrier, simply add its parameters and update the relevant sets. In this tutorial, we will extend the system with a methanol synthesis plant (using H₂ and CO₂ as inputs) and a carbon capture unit (as a CO₂ supply).</p>
</div>
</div>
</section>
</section>
</section>
<section id="data-generation-and-model-implementation" class="level1 title">
<h1 class="title"><span class="flow">Data Generation and Model Implementation</span></h1>
<section id="load-packages" class="level2">
<h2 class="anchored" data-anchor-id="load-packages">1. Load Packages</h2>
<div id="2" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Pkg</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">add</span>(<span class="st">"JuMP"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">add</span>(<span class="st">"HiGHS"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">add</span>(<span class="st">"CSV"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">add</span>(<span class="st">"DataFrames"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">add</span>(<span class="st">"CairoMakie"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">add</span>(<span class="st">"Dates"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Required packages</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Statistics</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CSV</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Dates</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">JuMP</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">HiGHS</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CairoMakie</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up CairoMakie</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">set_theme!</span>(<span class="fu">theme_light</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-generation" class="level2">
<h2 class="anchored" data-anchor-id="data-generation">2. Data Generation</h2>
<div id="4" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set random seed for reproducibility</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">42</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the directory of the current file</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>file_directory <span class="op">=</span> <span class="st">"</span><span class="sc">$</span>(<span class="pp">@__DIR__</span>)<span class="st">/data"</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of scenarios and time periods</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>n_scenarios <span class="op">=</span> <span class="fl">5</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>n_hours <span class="op">=</span> <span class="fl">168</span>  <span class="co"># One week</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate scenario data</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>scenario_data <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    scenario <span class="op">=</span> <span class="dt">String</span>[],</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    datetime <span class="op">=</span> <span class="dt">DateTime</span>[],</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    demand_meoh <span class="op">=</span> <span class="dt">Float64</span>[],</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    wind_cf <span class="op">=</span> <span class="dt">Float64</span>[],</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    pv_cf <span class="op">=</span> <span class="dt">Float64</span>[],</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    market_price <span class="op">=</span> <span class="dt">Float64</span>[],</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    probability <span class="op">=</span> <span class="dt">Float64</span>[]</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Base datetime</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>base_datetime <span class="op">=</span> <span class="fu">DateTime</span>(<span class="fl">2024</span>, <span class="fl">1</span>, <span class="fl">1</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate data for each scenario</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n_scenarios</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Methanol demand (constant for simplicity)</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    demand_meoh <span class="op">=</span> <span class="fu">fill</span>(<span class="fl">10.0</span>, n_hours)  <span class="co"># 10 t/h equivalent</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Wind capacity factors</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    wind_cf <span class="op">=</span> <span class="fu">rand</span>(n_hours)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PV capacity factors (daily pattern)</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    hour_of_day <span class="op">=</span> <span class="fu">mod</span>.(<span class="fl">0</span><span class="op">:</span>n_hours<span class="op">-</span><span class="fl">1</span>, <span class="fl">24</span>)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    pv_cf <span class="op">=</span> <span class="fu">max</span>.(<span class="fl">0</span>, <span class="fu">sin</span>.(<span class="cn">π</span> <span class="op">.*</span> hour_of_day <span class="op">./</span> <span class="fl">12</span>)) <span class="op">.+</span> <span class="fu">randn</span>(n_hours) <span class="op">.*</span> <span class="fl">0.1</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    pv_cf <span class="op">=</span> <span class="fu">max</span>.(<span class="fl">0</span>, <span class="fu">min</span>.(<span class="fl">1</span>, pv_cf))</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Market prices</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    base_price <span class="op">=</span> <span class="fl">200</span> <span class="op">.+</span> <span class="fl">100</span> <span class="op">.*</span> <span class="fu">sin</span>.(<span class="fl">2</span>π <span class="op">.*</span> (<span class="fl">0</span><span class="op">:</span>n_hours<span class="op">-</span><span class="fl">1</span>) <span class="op">./</span> <span class="fl">24</span>)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    market_price <span class="op">=</span> base_price <span class="op">.+</span> <span class="fu">randn</span>(n_hours) <span class="op">.*</span> <span class="fl">100</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    market_price <span class="op">=</span> <span class="fu">max</span>.(<span class="op">-</span><span class="fl">500</span>, <span class="fu">min</span>.(<span class="fl">1000</span>, market_price))</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n_hours</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(scenario_data, (</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>            <span class="st">"S</span><span class="sc">$</span>s<span class="st">"</span>,</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>            base_datetime <span class="op">+</span> <span class="fu">Hour</span>(h<span class="op">-</span><span class="fl">1</span>),</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>            demand_meoh[h],</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>            wind_cf[h],</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>            pv_cf[h],</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>            market_price[h],</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>            <span class="fl">1</span><span class="op">/</span>n_scenarios</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>CSV.<span class="fu">write</span>(<span class="st">"</span><span class="sc">$</span>file_directory<span class="st">/scenario.csv"</span>, scenario_data)</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid data (electricity supply)</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>grid_data <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> [<span class="st">"grid"</span>],</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    taxes_levies <span class="op">=</span> [<span class="fl">50.0</span>]  <span class="co"># EUR/MWh</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>CSV.<span class="fu">write</span>(<span class="st">"</span><span class="sc">$</span>file_directory<span class="st">/grid.csv"</span>, grid_data)</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Storage data (battery example)</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>storage_data <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> [<span class="st">"battery"</span>],</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>    energy_cost <span class="op">=</span> [<span class="fl">100000.0</span>],  <span class="co"># EUR/MWh</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>    power_cost <span class="op">=</span> [<span class="fl">50000.0</span>],    <span class="co"># EUR/MW</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    lifetime <span class="op">=</span> [<span class="fl">10</span>],</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>    discount_rate <span class="op">=</span> [<span class="fl">0.05</span>],</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>    charge_efficiency <span class="op">=</span> [<span class="fl">0.95</span>],</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>    discharge_efficiency <span class="op">=</span> [<span class="fl">0.95</span>],</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>    self_discharge_rate <span class="op">=</span> [<span class="fl">0.001</span>]</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>CSV.<span class="fu">write</span>(<span class="st">"</span><span class="sc">$</span>file_directory<span class="st">/storage.csv"</span>, storage_data)</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Wind turbine data</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>wind_data <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> [<span class="st">"wind"</span>],</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    power_cost <span class="op">=</span> [<span class="fl">1000000.0</span>],  <span class="co"># EUR/MW</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>    lifetime <span class="op">=</span> [<span class="fl">20</span>],</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>    discount_rate <span class="op">=</span> [<span class="fl">0.05</span>]</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>CSV.<span class="fu">write</span>(<span class="st">"</span><span class="sc">$</span>file_directory<span class="st">/windTurbine.csv"</span>, wind_data)</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a><span class="co"># PV data</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>pv_data <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> [<span class="st">"pv"</span>],</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>    power_cost <span class="op">=</span> [<span class="fl">500000.0</span>],   <span class="co"># EUR/MW</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    lifetime <span class="op">=</span> [<span class="fl">25</span>],</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    discount_rate <span class="op">=</span> [<span class="fl">0.05</span>]</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>CSV.<span class="fu">write</span>(<span class="st">"</span><span class="sc">$</span>file_directory<span class="st">/pv.csv"</span>, pv_data)</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Electrolyzer data (conversion: electricity -&gt; hydrogen)</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>electrolyzer_data <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> [<span class="st">"electrolyzer"</span>],</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>    power_cost <span class="op">=</span> [<span class="fl">800000.0</span>],   <span class="co"># EUR/MW</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>    lifetime <span class="op">=</span> [<span class="fl">15</span>],</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>    discount_rate <span class="op">=</span> [<span class="fl">0.05</span>],</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>    var_cost <span class="op">=</span> [<span class="fl">5.0</span>],          <span class="co"># EUR/MWh H2</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Nominal input/output flows at 1 MW nominal power</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>    input_carrier <span class="op">=</span> [<span class="st">"electricity"</span>],</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>    output_carrier <span class="op">=</span> [<span class="st">"hydrogen"</span>],</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>    input_flow_nom <span class="op">=</span> [<span class="fl">1.0</span>],    <span class="co"># 1 MW electricity in</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>    output_flow_nom <span class="op">=</span> [<span class="fl">0.0018</span>]    <span class="co"># 0.0018 t/h hydrogen out (ca. 60% efficiency)</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>CSV.<span class="fu">write</span>(<span class="st">"</span><span class="sc">$</span>file_directory<span class="st">/electrolyzer.csv"</span>, electrolyzer_data)</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a><span class="co"># Methanol synthesis data (conversion: hydrogen + CO2 -&gt; methanol)</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>methanol_data <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> [<span class="st">"meoh_synth"</span>],</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>    power_cost <span class="op">=</span> [<span class="fl">1200000.0</span>],  <span class="co"># EUR/t H2</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>    lifetime <span class="op">=</span> [<span class="fl">20</span>],</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>    discount_rate <span class="op">=</span> [<span class="fl">0.05</span>],</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>    var_cost <span class="op">=</span> [<span class="fl">10.0</span>],         <span class="co"># EUR/t H2</span></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>    input_carrier <span class="op">=</span> [<span class="st">"hydrogen,CO2,electricity"</span>],</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>    output_carrier <span class="op">=</span> [<span class="st">"methanol,water"</span>],</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>    input_flow_nom <span class="op">=</span> [<span class="fl">0.19</span>,<span class="fl">1.37</span>,<span class="fl">0.03</span>],  <span class="co"># 0.19 t/h H2, 1.37 t/h CO2, 0.03 MW electricity in</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>    output_flow_nom <span class="op">=</span> [<span class="fl">1.0</span>,<span class="fl">0.56</span>]        <span class="co"># 1 t methanol out</span></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>CSV.<span class="fu">write</span>(<span class="st">"</span><span class="sc">$</span>file_directory<span class="st">/methanol.csv"</span>, methanol_data)</span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Carbon capture (CO2 supply, fixed outflow)</span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>co2_supply_data <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> [<span class="st">"co2_supply"</span>],</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>    supply_carrier <span class="op">=</span> [<span class="st">"CO2"</span>],</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>    outflow_nom <span class="op">=</span> [<span class="fl">20.0</span>],      <span class="co"># 20 t CO2 available (fixed)</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>    var_cost <span class="op">=</span> [<span class="fl">20.0</span>]          <span class="co"># EUR/t CO2</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>CSV.<span class="fu">write</span>(<span class="st">"</span><span class="sc">$</span>file_directory<span class="st">/co2_supply.csv"</span>, co2_supply_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-and-process-data" class="level2">
<h2 class="anchored" data-anchor-id="load-and-process-data">3. Load and Process Data</h2>
<div id="6" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span>, <span class="bu">CSV</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load all technology data</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>file_directory <span class="op">=</span> <span class="st">"</span><span class="sc">$</span>(<span class="pp">@__DIR__</span>)<span class="st">/data"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>dfStorage <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"</span><span class="sc">$</span>file_directory<span class="st">/storage.csv"</span>, DataFrame)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>dfWind <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"</span><span class="sc">$</span>file_directory<span class="st">/windTurbine.csv"</span>, DataFrame)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>dfPV <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"</span><span class="sc">$</span>file_directory<span class="st">/pv.csv"</span>, DataFrame)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>dfElectrolyzer <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"</span><span class="sc">$</span>file_directory<span class="st">/electrolyzer.csv"</span>, DataFrame)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>dfMethanol <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"</span><span class="sc">$</span>file_directory<span class="st">/methanol.csv"</span>, DataFrame)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>dfCO2Supply <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"</span><span class="sc">$</span>file_directory<span class="st">/co2_supply.csv"</span>, DataFrame)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>dfScenarios <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"</span><span class="sc">$</span>file_directory<span class="st">/scenario.csv"</span>, DataFrame)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>dfGrid <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"</span><span class="sc">$</span>file_directory<span class="st">/grid.csv"</span>, DataFrame)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Build technology dictionaries with PVAF calculation ---</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Storage units (G^S)</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>dictGS <span class="op">=</span> <span class="fu">Dict</span>()</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> <span class="fu">eachrow</span>(dfStorage)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    pvaf <span class="op">=</span> (<span class="fl">1</span> <span class="op">+</span> row.discount_rate)<span class="op">^</span>row.lifetime <span class="op">/</span> </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>           (row.discount_rate <span class="op">*</span> (<span class="fl">1</span> <span class="op">+</span> row.discount_rate)<span class="op">^</span>row.lifetime)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    dictGS[row.name] <span class="op">=</span> (</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        energy_cost <span class="op">=</span> row.energy_cost,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>        power_cost <span class="op">=</span> row.power_cost,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        lifetime <span class="op">=</span> row.lifetime,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        discount_rate <span class="op">=</span> row.discount_rate,</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>        charge_efficiency <span class="op">=</span> row.charge_efficiency,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>        discharge_efficiency <span class="op">=</span> row.discharge_efficiency,</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        self_discharge_rate <span class="op">=</span> row.self_discharge_rate,</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        pvaf <span class="op">=</span> pvaf</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable renewables (G^Var)</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>dictGVar <span class="op">=</span> <span class="fu">Dict</span>()</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> <span class="fu">eachrow</span>(dfWind)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    pvaf <span class="op">=</span> (<span class="fl">1</span> <span class="op">+</span> row.discount_rate)<span class="op">^</span>row.lifetime <span class="op">/</span> </span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>           (row.discount_rate <span class="op">*</span> (<span class="fl">1</span> <span class="op">+</span> row.discount_rate)<span class="op">^</span>row.lifetime)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    dictGVar[row.name] <span class="op">=</span> (</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>        power_cost <span class="op">=</span> row.power_cost,</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>        lifetime <span class="op">=</span> row.lifetime,</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>        discount_rate <span class="op">=</span> row.discount_rate,</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>        pvaf <span class="op">=</span> pvaf</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> <span class="fu">eachrow</span>(dfPV)</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    pvaf <span class="op">=</span> (<span class="fl">1</span> <span class="op">+</span> row.discount_rate)<span class="op">^</span>row.lifetime <span class="op">/</span> </span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>           (row.discount_rate <span class="op">*</span> (<span class="fl">1</span> <span class="op">+</span> row.discount_rate)<span class="op">^</span>row.lifetime)</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    dictGVar[row.name] <span class="op">=</span> (</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>        power_cost <span class="op">=</span> row.power_cost,</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>        lifetime <span class="op">=</span> row.lifetime,</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>        discount_rate <span class="op">=</span> row.discount_rate,</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>        pvaf <span class="op">=</span> pvaf</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Conversion units (G^Conv)</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>dictGConv <span class="op">=</span> <span class="fu">Dict</span>()</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Electrolyzer</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> <span class="fu">eachrow</span>(dfElectrolyzer)</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    pvaf <span class="op">=</span> (<span class="fl">1</span> <span class="op">+</span> row.discount_rate)<span class="op">^</span>row.lifetime <span class="op">/</span> </span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>           (row.discount_rate <span class="op">*</span> (<span class="fl">1</span> <span class="op">+</span> row.discount_rate)<span class="op">^</span>row.lifetime)</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate sigma and theta</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    input_carrier <span class="op">=</span> <span class="fu">split</span>(row.input_carrier, <span class="st">","</span>)</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    output_carrier <span class="op">=</span> <span class="fu">split</span>(row.output_carrier, <span class="st">","</span>)</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>    input_flow_nom <span class="op">=</span> [<span class="fu">parse</span>(<span class="dt">Float64</span>, x) for x <span class="kw">in</span> <span class="fu">split</span>(<span class="fu">string</span>(row.input_flow_nom), <span class="st">","</span>)]</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    output_flow_nom <span class="op">=</span> [<span class="fu">parse</span>(<span class="dt">Float64</span>, x) for x <span class="kw">in</span> <span class="fu">split</span>(<span class="fu">string</span>(row.output_flow_nom), <span class="st">","</span>)]</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>    sigma_in <span class="op">=</span> <span class="fu">Dict</span>(input_carrier[i] <span class="op">=&gt;</span> input_flow_nom[i]<span class="op">/</span><span class="fu">sum</span>(input_flow_nom) <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(input_carrier))</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    sigma_out <span class="op">=</span> <span class="fu">Dict</span>(output_carrier[i] <span class="op">=&gt;</span> output_flow_nom[i]<span class="op">/</span><span class="fu">sum</span>(output_flow_nom) <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(output_carrier))</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    theta <span class="op">=</span> <span class="fu">sum</span>(output_flow_nom) <span class="op">/</span> <span class="fu">sum</span>(input_flow_nom)</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>    dictGConv[row.name] <span class="op">=</span> (</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>        power_cost <span class="op">=</span> row.power_cost,</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>        lifetime <span class="op">=</span> row.lifetime,</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>        discount_rate <span class="op">=</span> row.discount_rate,</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>        var_cost <span class="op">=</span> row.var_cost,</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>        input_carrier <span class="op">=</span> input_carrier,</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>        output_carrier <span class="op">=</span> output_carrier,</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>        sigma_in <span class="op">=</span> sigma_in,</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>        sigma_out <span class="op">=</span> sigma_out,</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>        theta <span class="op">=</span> theta,</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>        pvaf <span class="op">=</span> pvaf</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Methanol synthesis</span></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> <span class="fu">eachrow</span>(dfMethanol)</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>    pvaf <span class="op">=</span> (<span class="fl">1</span> <span class="op">+</span> row.discount_rate)<span class="op">^</span>row.lifetime <span class="op">/</span> </span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>           (row.discount_rate <span class="op">*</span> (<span class="fl">1</span> <span class="op">+</span> row.discount_rate)<span class="op">^</span>row.lifetime)</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>    input_carrier <span class="op">=</span> <span class="fu">split</span>(row.input_carrier, <span class="st">","</span>)</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>    output_carrier <span class="op">=</span> <span class="fu">split</span>(row.output_carrier, <span class="st">","</span>)</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>    input_flow_nom <span class="op">=</span> [<span class="fu">parse</span>(<span class="dt">Float64</span>, x) for x <span class="kw">in</span> <span class="fu">split</span>(<span class="fu">string</span>(row.input_flow_nom), <span class="st">","</span>)]</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>    output_flow_nom <span class="op">=</span> [<span class="fu">parse</span>(<span class="dt">Float64</span>, x) for x <span class="kw">in</span> <span class="fu">split</span>(<span class="fu">string</span>(row.output_flow_nom), <span class="st">","</span>)]</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>    sigma_in <span class="op">=</span> <span class="fu">Dict</span>(input_carrier[i] <span class="op">=&gt;</span> input_flow_nom[i]<span class="op">/</span><span class="fu">sum</span>(input_flow_nom) <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(input_carrier))</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>    sigma_out <span class="op">=</span> <span class="fu">Dict</span>(output_carrier[i] <span class="op">=&gt;</span> output_flow_nom[i]<span class="op">/</span><span class="fu">sum</span>(output_flow_nom) <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(output_carrier))</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>    theta <span class="op">=</span> <span class="fu">sum</span>(output_flow_nom) <span class="op">/</span> <span class="fu">sum</span>(input_flow_nom)</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>    dictGConv[row.name] <span class="op">=</span> (</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>        power_cost <span class="op">=</span> row.power_cost,</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>        lifetime <span class="op">=</span> row.lifetime,</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>        discount_rate <span class="op">=</span> row.discount_rate,</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>        var_cost <span class="op">=</span> row.var_cost,</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>        input_carrier <span class="op">=</span> input_carrier,</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>        output_carrier <span class="op">=</span> output_carrier,</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>        sigma_in <span class="op">=</span> sigma_in,</span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>        sigma_out <span class="op">=</span> sigma_out,</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>        theta <span class="op">=</span> theta,</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>        pvaf <span class="op">=</span> pvaf</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a><span class="co"># Supply units (G^Sup)</span></span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>dictGSup <span class="op">=</span> <span class="fu">Dict</span>()</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> <span class="fu">eachrow</span>(dfCO2Supply)</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>    dictGSup[row.name] <span class="op">=</span> (</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>        supply_carrier <span class="op">=</span> row.supply_carrier,</span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>        outflow_nom <span class="op">=</span> row.outflow_nom,</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>        var_cost <span class="op">=</span> row.var_cost</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid as supply (electricity)</span></span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> <span class="fu">eachrow</span>(dfGrid)</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>    dictGSup[row.name] <span class="op">=</span> (</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>        supply_carrier <span class="op">=</span> <span class="st">"electricity"</span>,</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>        taxes_levies <span class="op">=</span> row.taxes_levies</span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Build general technology dictionary and sets ---</span></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a><span class="co"># Union of all technology dictionaries</span></span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>dictG <span class="op">=</span> <span class="fu">merge</span>(dictGS, dictGVar, dictGConv, dictGSup)</span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Sets of technology names</span></span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>GS <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">keys</span>(dictGS))</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>GVar <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">keys</span>(dictGVar))</span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>GConv <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">keys</span>(dictGConv))</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>GSup <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">keys</span>(dictGSup))</span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">keys</span>(dictG))</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Build supply dictionary for CO2 supply ---</span></span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>dictSupply <span class="op">=</span> <span class="fu">Dict</span>()</span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> <span class="fu">eachrow</span>(dfCO2Supply)</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>    dictSupply[row.supply_carrier] <span class="op">=</span> (</span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>        outflow_nom <span class="op">=</span> row.outflow_nom,</span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>        var_cost <span class="op">=</span> row.var_cost</span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Prepare scenario data with carrier-specific information ---</span></span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>dictScenarios <span class="op">=</span> <span class="fu">Dict</span>()</span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> scenario <span class="kw">in</span> <span class="fu">unique</span>(dfScenarios.scenario)</span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>    scenario_data <span class="op">=</span> dfScenarios[dfScenarios.scenario <span class="op">.==</span> scenario, <span class="op">:</span>]</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create carrier-specific demand dictionary</span></span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>    demand <span class="op">=</span> <span class="fu">Dict</span>(</span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>        <span class="st">"methanol"</span> <span class="op">=&gt;</span> scenario_data.demand_meoh</span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create technology-specific capacity factors</span></span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>    cf <span class="op">=</span> <span class="fu">Dict</span>(</span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>        <span class="st">"wind"</span> <span class="op">=&gt;</span> scenario_data.wind_cf,</span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>        <span class="st">"pv"</span> <span class="op">=&gt;</span> scenario_data.pv_cf</span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create carrier-specific market prices</span></span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>    market_price <span class="op">=</span> <span class="fu">Dict</span>(</span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>        <span class="st">"electricity"</span> <span class="op">=&gt;</span> scenario_data.market_price,</span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>        <span class="st">"hydrogen"</span> <span class="op">=&gt;</span> <span class="fu">fill</span>(<span class="fl">300.0</span>, <span class="fu">length</span>(scenario_data.market_price)),  <span class="co"># Fixed H2 price</span></span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>        <span class="st">"methanol"</span> <span class="op">=&gt;</span> <span class="fu">fill</span>(<span class="fl">70.0</span>, <span class="fu">length</span>(scenario_data.market_price)),   <span class="co"># Fixed MeOH price (70 EUR/t)</span></span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CO2"</span> <span class="op">=&gt;</span> <span class="fu">fill</span>(<span class="fl">50.0</span>, <span class="fu">length</span>(scenario_data.market_price))         <span class="co"># Fixed CO2 price</span></span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>    dictScenarios[scenario] <span class="op">=</span> (</span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>        datetime <span class="op">=</span> scenario_data.datetime,</span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a>        demand <span class="op">=</span> demand,</span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>        cf <span class="op">=</span> cf,</span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>        market_price <span class="op">=</span> market_price,</span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>        probability <span class="op">=</span> scenario_data.probability[<span class="fl">1</span>]</span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-implementation" class="level2">
<h2 class="anchored" data-anchor-id="model-implementation">4. Model Implementation</h2>
<p>Now, let’s implement the general Multi-Energy System Framework based on the Stochastic System Design model:</p>
<div id="8" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">solve_mes_framework</span>(dictGS, dictGVar, dictGConv, dictGSup, dictScenarios, dictSupply, max_budget)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create model</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> <span class="fu">Model</span>(HiGHS.Optimizer)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_silent</span>(model)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define sets</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    T <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">168</span>  <span class="co"># Time periods (hours)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    GS <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">keys</span>(dictGS))  <span class="co"># Storage units</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    GVar <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">keys</span>(dictGVar))  <span class="co"># Variable renewable units</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    GConv <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">keys</span>(dictGConv))  <span class="co"># Conversion units</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    GSup <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">keys</span>(dictGSup))  <span class="co"># Supply units</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    G <span class="op">=</span> <span class="fu">vcat</span>(GS, GVar, GConv, GSup)  <span class="co"># All technology units</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    Ω <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">keys</span>(dictScenarios))  <span class="co"># Scenarios</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build set of energy carriers E and mapping sets inside the function</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    E <span class="op">=</span> <span class="fu">Set</span><span class="dt">{String}</span>()</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> g <span class="kw">in</span> G</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="fu">haskey</span>(dictG, g)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="fu">haskey</span>(dictG[g], <span class="op">:</span>input_carrier)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="cn">e</span> <span class="kw">in</span> dictG[g].input_carrier</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">push!</span>(E, <span class="cn">e</span>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>                <span class="cf">end</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="fu">haskey</span>(dictG[g], <span class="op">:</span>output_carrier)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="cn">e</span> <span class="kw">in</span> dictG[g].output_carrier</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">push!</span>(E, <span class="cn">e</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                <span class="cf">end</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="fu">haskey</span>(dictG[g], <span class="op">:</span>supply_carrier)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                <span class="fu">push!</span>(E, dictG[g].supply_carrier)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    E <span class="op">=</span> <span class="fu">collect</span>(E)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mapping sets for inflow and outflow carriers for each g</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    E_g_in <span class="op">=</span> <span class="fu">Dict</span>(g <span class="op">=&gt;</span> <span class="fu">get</span>(dictG[g], <span class="op">:</span>input_carrier, <span class="dt">String</span>[])) <span class="cf">for</span> g <span class="kw">in</span> G</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    E_g_out <span class="op">=</span> <span class="fu">Dict</span>(g <span class="op">=&gt;</span> <span class="fu">get</span>(dictG[g], <span class="op">:</span>output_carrier, <span class="dt">String</span>[])) <span class="cf">for</span> g <span class="kw">in</span> G</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Carriers with demand</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    ED <span class="op">=</span> [<span class="st">"methanol"</span>]  <span class="co"># Only methanol has demand</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Decision Variables</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Investment variables (First Stage)</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@variable</span>(model, P_nom[g <span class="kw">in</span> G] <span class="op">&gt;=</span> <span class="fl">0</span>)  <span class="co"># Nominal capacity</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@variable</span>(model, SOC_nom[g <span class="kw">in</span> GS] <span class="op">&gt;=</span> <span class="fl">0</span>)  <span class="co"># Storage energy capacity</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Operational variables (Second Stage)</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@variable</span>(model, x_in[g <span class="kw">in</span> G, <span class="cn">e</span> <span class="kw">in</span> E, t <span class="kw">in</span> T, ω <span class="kw">in</span> Ω] <span class="op">&gt;=</span> <span class="fl">0</span>)  <span class="co"># Input flow</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@variable</span>(model, x_out[g <span class="kw">in</span> G, <span class="cn">e</span> <span class="kw">in</span> E, t <span class="kw">in</span> T, ω <span class="kw">in</span> Ω] <span class="op">&gt;=</span> <span class="fl">0</span>)  <span class="co"># Output flow</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@variable</span>(model, x_total[g <span class="kw">in</span> G, t <span class="kw">in</span> T, ω <span class="kw">in</span> Ω] <span class="op">&gt;=</span> <span class="fl">0</span>)  <span class="co"># Total activity</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@variable</span>(model, soc[g <span class="kw">in</span> GS, t <span class="kw">in</span> T, ω <span class="kw">in</span> Ω] <span class="op">&gt;=</span> <span class="fl">0</span>)  <span class="co"># State of charge</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@variable</span>(model, f_buy[<span class="cn">e</span> <span class="kw">in</span> E, t <span class="kw">in</span> T, ω <span class="kw">in</span> Ω] <span class="op">&gt;=</span> <span class="fl">0</span>)  <span class="co"># Buy flow</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@variable</span>(model, f_sell[<span class="cn">e</span> <span class="kw">in</span> E, t <span class="kw">in</span> T, ω <span class="kw">in</span> Ω] <span class="op">&gt;=</span> <span class="fl">0</span>)  <span class="co"># Sell flow</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Binary variables</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@variable</span>(model, u[g <span class="kw">in</span> GConv, t <span class="kw">in</span> T, ω <span class="kw">in</span> Ω], Bin)  <span class="co"># On/off status</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@variable</span>(model, o[g <span class="kw">in</span> GS, t <span class="kw">in</span> T, ω <span class="kw">in</span> Ω], Bin)  <span class="co"># Charge/discharge</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cost variables</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@variable</span>(model, AC_inv[g <span class="kw">in</span> G] <span class="op">&gt;=</span> <span class="fl">0</span>)  <span class="co"># Annual investment cost</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@variable</span>(model, c_start[g <span class="kw">in</span> GConv, t <span class="kw">in</span> T, ω <span class="kw">in</span> Ω] <span class="op">&gt;=</span> <span class="fl">0</span>)  <span class="co"># Startup cost</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Objective Function: Maximize profit</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@objective</span>(model, Max,</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Revenue from selling energy carriers</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sum</span>(dictScenarios[ω].probability <span class="op">*</span> </span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum</span>(dictScenarios[ω].market_price[<span class="cn">e</span>][t] <span class="op">*</span> f_sell[<span class="cn">e</span>,t,ω] </span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="cn">e</span> <span class="kw">in</span> E, t <span class="kw">in</span> T) <span class="cf">for</span> ω <span class="kw">in</span> Ω) <span class="op">*</span> <span class="fl">52.1429</span> <span class="op">-</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Costs of buying energy carriers</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sum</span>(dictScenarios[ω].probability <span class="op">*</span> </span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum</span>(dictScenarios[ω].market_price[<span class="cn">e</span>][t] <span class="op">*</span> f_buy[<span class="cn">e</span>,t,ω] </span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="cn">e</span> <span class="kw">in</span> E, t <span class="kw">in</span> T) <span class="cf">for</span> ω <span class="kw">in</span> Ω) <span class="op">*</span> <span class="fl">52.1429</span> <span class="op">-</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Variable operating costs</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sum</span>(dictScenarios[ω].probability <span class="op">*</span> </span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum</span>(dictGConv[g].var_cost <span class="op">*</span> x_total[g,t,ω] </span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> g <span class="kw">in</span> GConv, t <span class="kw">in</span> T) <span class="cf">for</span> ω <span class="kw">in</span> Ω) <span class="op">*</span> <span class="fl">52.1429</span> <span class="op">-</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Investment costs</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sum</span>(AC_inv[g] <span class="cf">for</span> g <span class="kw">in</span> G)</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Investment cost constraints</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@constraint</span>(model, [g <span class="kw">in</span> GS], AC_inv[g] <span class="op">==</span> </span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>        dictGS[g].power_cost<span class="op">/</span>dictGS[g].pvaf <span class="op">*</span> P_nom[g] <span class="op">+</span> </span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>        dictGS[g].energy_cost<span class="op">/</span>dictGS[g].pvaf <span class="op">*</span> SOC_nom[g])</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@constraint</span>(model, [g <span class="kw">in</span> <span class="fu">vcat</span>(GVar, GConv)], AC_inv[g] <span class="op">==</span> </span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>        dictG[g].power_cost<span class="op">/</span>dictG[g].pvaf <span class="op">*</span> P_nom[g])</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Investment budget constraint</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@constraint</span>(model, <span class="fu">sum</span>(AC_inv[g] <span class="cf">for</span> g <span class="kw">in</span> G) <span class="op">&lt;=</span> max_budget)</span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Energy conversion constraints</span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Input-output relationships for conversion units</span></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@constraint</span>(model, [g <span class="kw">in</span> GConv, <span class="cn">e</span> <span class="kw">in</span> dictGConv[g].input_carrier, t <span class="kw">in</span> T, ω <span class="kw">in</span> Ω],</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>        x_in[g,<span class="cn">e</span>,t,ω] <span class="op">==</span> dictGConv[g].sigma_in[<span class="cn">e</span>] <span class="op">*</span> x_total[g,t,ω])</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@constraint</span>(model, [g <span class="kw">in</span> GConv, <span class="cn">e</span> <span class="kw">in</span> dictGConv[g].output_carrier, t <span class="kw">in</span> T, ω <span class="kw">in</span> Ω],</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>        x_out[g,<span class="cn">e</span>,t,ω] <span class="op">==</span> dictGConv[g].sigma_out[<span class="cn">e</span>] <span class="op">*</span> dictGConv[g].theta <span class="op">*</span> x_total[g,t,ω])</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Technology capacity limits</span></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@constraint</span>(model, [g <span class="kw">in</span> GConv, t <span class="kw">in</span> T, ω <span class="kw">in</span> Ω],</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.1</span> <span class="op">*</span> P_nom[g] <span class="op">*</span> u[g,t,ω] <span class="op">&lt;=</span> x_total[g,t,ω] <span class="op">&lt;=</span> P_nom[g] <span class="op">*</span> u[g,t,ω])</span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Variable energy technologies</span></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@constraint</span>(model, [g <span class="kw">in</span> GVar, t <span class="kw">in</span> T, ω <span class="kw">in</span> Ω],</span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>        x_total[g,t,ω] <span class="op">&lt;=</span> dictScenarios[ω].cf[g][t] <span class="op">*</span> P_nom[g])</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Storage constraints</span></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@constraint</span>(model, [g <span class="kw">in</span> GS, t <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu">length</span>(T), ω <span class="kw">in</span> Ω],</span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>        soc[g,t,ω] <span class="op">==</span> (<span class="fl">1</span> <span class="op">-</span> dictGS[g].self_discharge_rate) <span class="op">*</span> soc[g,t<span class="op">-</span><span class="fl">1</span>,ω] <span class="op">+</span></span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>        dictGS[g].charge_efficiency <span class="op">*</span> x_total[g,t,ω] <span class="op">-</span></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sum</span>(x_out[g,<span class="cn">e</span>,t,ω] <span class="cf">for</span> <span class="cn">e</span> <span class="kw">in</span> E) <span class="op">/</span> dictGS[g].discharge_efficiency)</span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@constraint</span>(model, [g <span class="kw">in</span> GS, ω <span class="kw">in</span> Ω],</span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>        soc[g,<span class="fl">1</span>,ω] <span class="op">==</span> dictGS[g].charge_efficiency <span class="op">*</span> x_total[g,<span class="fl">1</span>,ω] <span class="op">-</span></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sum</span>(x_out[g,<span class="cn">e</span>,<span class="fl">1</span>,ω] <span class="cf">for</span> <span class="cn">e</span> <span class="kw">in</span> E) <span class="op">/</span> dictGS[g].discharge_efficiency)</span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Storage capacity limits</span></span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@constraint</span>(model, [g <span class="kw">in</span> GS, t <span class="kw">in</span> T, ω <span class="kw">in</span> Ω],</span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>        soc[g,t,ω] <span class="op">&lt;=</span> SOC_nom[g])</span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Storage charging/discharging mutual exclusion</span></span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@constraint</span>(model, [g <span class="kw">in</span> GS, t <span class="kw">in</span> T, ω <span class="kw">in</span> Ω],</span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.1</span> <span class="op">*</span> P_nom[g] <span class="op">*</span> o[g,t,ω] <span class="op">&lt;=</span> x_total[g,t,ω] <span class="op">&lt;=</span> P_nom[g] <span class="op">*</span> o[g,t,ω])</span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@constraint</span>(model, [g <span class="kw">in</span> GS, t <span class="kw">in</span> T, ω <span class="kw">in</span> Ω],</span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.1</span> <span class="op">*</span> P_nom[g] <span class="op">*</span> (<span class="fl">1</span><span class="op">-</span>o[g,t,ω]) <span class="op">&lt;=</span> </span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sum</span>(x_out[g,<span class="cn">e</span>,t,ω] <span class="cf">for</span> <span class="cn">e</span> <span class="kw">in</span> E) <span class="op">&lt;=</span> P_nom[g] <span class="op">*</span> (<span class="fl">1</span><span class="op">-</span>o[g,t,ω]))</span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Supply unit constraints (fixed outflow)</span></span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@constraint</span>(model, [g <span class="kw">in</span> GSup, t <span class="kw">in</span> T, ω <span class="kw">in</span> Ω],</span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a>        <span class="fu">haskey</span>(dictGSup[g], <span class="op">:</span>outflow_nom) ? </span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>        x_out[g,dictGSup[g].supply_carrier,t,ω] <span class="op">&lt;=</span> dictGSup[g].outflow_nom <span class="op">:</span> </span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>        x_out[g,dictGSup[g].supply_carrier,t,ω] <span class="op">&gt;=</span> <span class="fl">0</span>)</span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Energy balance constraints</span></span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@constraint</span>(model, [<span class="cn">e</span> <span class="kw">in</span> ED, t <span class="kw">in</span> T, ω <span class="kw">in</span> Ω],</span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sum</span>(x_out[g,<span class="cn">e</span>,t,ω] <span class="cf">for</span> g <span class="kw">in</span> G) <span class="op">+</span> f_buy[<span class="cn">e</span>,t,ω] <span class="op">==</span> </span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sum</span>(x_in[g,<span class="cn">e</span>,t,ω] <span class="cf">for</span> g <span class="kw">in</span> G) <span class="op">+</span> f_sell[<span class="cn">e</span>,t,ω] <span class="op">+</span> dictScenarios[ω].demand[<span class="cn">e</span>][t])</span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Solve the model</span></span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a>    <span class="fu">optimize!</span>(model)</span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check solution status</span></span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">termination_status</span>(model) <span class="op">!=</span> MOI.OPTIMAL</span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a>        ts <span class="op">=</span> <span class="fu">termination_status</span>(model)</span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@info</span> <span class="st">"Optimization finished. The model was not solved correctly. Termination Status: </span><span class="sc">$</span>ts<span class="st">"</span></span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return results</span></span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a>        P_nom <span class="op">=</span> <span class="fu">value</span>.(P_nom),</span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a>        SOC_nom <span class="op">=</span> <span class="fu">value</span>.(SOC_nom),</span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a>        total_cost <span class="op">=</span> <span class="fu">objective_value</span>(model),</span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a>        investment_costs <span class="op">=</span> <span class="fu">Dict</span>(g <span class="op">=&gt;</span> <span class="fu">value</span>.(AC_inv[g]) <span class="cf">for</span> g <span class="kw">in</span> G),</span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a>        operational_variables <span class="op">=</span> <span class="fu">Dict</span>(</span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a>            <span class="st">"x_in"</span> <span class="op">=&gt;</span> <span class="fu">value</span>.(x_in),</span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a>            <span class="st">"x_out"</span> <span class="op">=&gt;</span> <span class="fu">value</span>.(x_out),</span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a>            <span class="st">"x_total"</span> <span class="op">=&gt;</span> <span class="fu">value</span>.(x_total),</span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a>            <span class="st">"soc"</span> <span class="op">=&gt;</span> <span class="fu">value</span>.(soc),</span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a>            <span class="st">"f_buy"</span> <span class="op">=&gt;</span> <span class="fu">value</span>.(f_buy),</span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a>            <span class="st">"f_sell"</span> <span class="op">=&gt;</span> <span class="fu">value</span>.(f_sell)</span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="solve-and-analyze-results" class="level2">
<h2 class="anchored" data-anchor-id="solve-and-analyze-results">5. Solve and Analyze Results</h2>
<p>Let’s solve the model with a maximum budget of 50 million EUR:</p>
<div id="10" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve model</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>max_budget <span class="op">=</span> <span class="fl">50_000_000</span>  <span class="co"># 50 million EUR</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> <span class="fu">solve_mes_framework</span>(dictGS, dictGVar, dictGConv, dictGSup, dictScenarios, dictSupply, max_budget)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create results DataFrame</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    component <span class="op">=</span> <span class="dt">String</span>[],</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    capacity <span class="op">=</span> <span class="dt">Float64</span>[],</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    investment_cost <span class="op">=</span> <span class="dt">Float64</span>[]</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add results for all technology types</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> g <span class="kw">in</span> <span class="fu">keys</span>(results.P_nom)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> g <span class="kw">in</span> GS</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(results_df, (g, results.P_nom[g], results.investment_costs[g]))</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elseif</span> g <span class="kw">in</span> GVar</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(results_df, (g, results.P_nom[g], results.investment_costs[g]))</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elseif</span> g <span class="kw">in</span> GConv</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(results_df, (g, results.P_nom[g], results.investment_costs[g]))</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total costs</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>total_investment_cost <span class="op">=</span> <span class="fu">sum</span>(<span class="fu">values</span>(results.investment_costs))</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>total_cost <span class="op">=</span> results.total_cost</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"Optimal Multi-Energy System Design:"</span>)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"="</span> <span class="op">*</span> <span class="fl">50</span>)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Storage results</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> g <span class="kw">in</span> GS</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"</span><span class="sc">$</span>g<span class="st">:"</span>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"  Power Capacity: </span><span class="sc">$</span>(<span class="fu">round</span>(results.P_nom[g], digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> MW"</span>)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"  Energy Capacity: </span><span class="sc">$</span>(<span class="fu">round</span>(results.SOC_nom[g], digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> MWh"</span>)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"  Investment Cost: </span><span class="sc">$</span>(<span class="fu">round</span>(results.investment_costs[g], digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> EUR/year"</span>)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable renewable results</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> g <span class="kw">in</span> GVar</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"</span><span class="sc">$</span>g<span class="st">:"</span>)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"  Power Capacity: </span><span class="sc">$</span>(<span class="fu">round</span>(results.P_nom[g], digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> MW"</span>)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"  Investment Cost: </span><span class="sc">$</span>(<span class="fu">round</span>(results.investment_costs[g], digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> EUR/year"</span>)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Conversion unit results</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> g <span class="kw">in</span> GConv</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"</span><span class="sc">$</span>g<span class="st">:"</span>)</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"  Power Capacity: </span><span class="sc">$</span>(<span class="fu">round</span>(results.P_nom[g], digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> MW"</span>)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"  Investment Cost: </span><span class="sc">$</span>(<span class="fu">round</span>(results.investment_costs[g], digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> EUR/year"</span>)</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Cost Summary:"</span>)</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"Total Annual Cost: </span><span class="sc">$</span>(<span class="fu">round</span>(total_cost, digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> EUR/year"</span>)</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"Total Investment Cost: </span><span class="sc">$</span>(<span class="fu">round</span>(total_investment_cost, digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> EUR/year"</span>)</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Create operational results DataFrame</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>operational_df <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    scenario <span class="op">=</span> <span class="dt">String</span>[],</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    hour <span class="op">=</span> <span class="dt">Int</span>[],</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    carrier <span class="op">=</span> <span class="dt">String</span>[],</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    demand <span class="op">=</span> <span class="dt">Float64</span>[],</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>    production <span class="op">=</span> <span class="dt">Float64</span>[],</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>    storage_energy <span class="op">=</span> <span class="dt">Float64</span>[],</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>    buy_flow <span class="op">=</span> <span class="dt">Float64</span>[],</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>    sell_flow <span class="op">=</span> <span class="dt">Float64</span>[]</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Add operational data for each scenario and carrier</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ω <span class="kw">in</span> <span class="fu">keys</span>(dictScenarios)</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">168</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="cn">e</span> <span class="kw">in</span> [<span class="st">"methanol"</span>]</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calculate total production for this carrier</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>            production <span class="op">=</span> <span class="fu">sum</span>(results.operational_variables[<span class="st">"x_out"</span>][g,<span class="cn">e</span>,t,ω] <span class="cf">for</span> g <span class="kw">in</span> G)</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get storage energy (only for electricity storage)</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>            storage_energy <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="cn">e</span> <span class="op">==</span> <span class="st">"electricity"</span></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> g <span class="kw">in</span> GS</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>                    storage_energy <span class="op">+=</span> results.operational_variables[<span class="st">"soc"</span>][g,t,ω]</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>                <span class="cf">end</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>            <span class="fu">push!</span>(operational_df, (</span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>                ω,</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>                t,</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>                <span class="cn">e</span>,</span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>                dictScenarios[ω].demand[<span class="cn">e</span>][t],</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>                production,</span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>                storage_energy,</span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>                results.operational_variables[<span class="st">"f_buy"</span>][<span class="cn">e</span>,t,ω],</span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>                results.operational_variables[<span class="st">"f_sell"</span>][<span class="cn">e</span>,t,ω]</span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>            ))</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-figures" class="level2">
<h2 class="anchored" data-anchor-id="create-figures">6. Create Figures</h2>
<div id="12" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create figure for component sizes and costs</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>fig1 <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1200</span>, <span class="fl">800</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Component sizes</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> <span class="fu">Axis</span>(fig1[<span class="fl">1</span>, <span class="fl">1</span>], title<span class="op">=</span><span class="st">"Optimal Component Sizes"</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>x_pos <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(results_df.component)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot!</span>(ax1, x_pos, results_df.capacity)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>ax1.xticks <span class="op">=</span> (x_pos, results_df.component)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>ax1.xticklabelrotation <span class="op">=</span> <span class="cn">π</span><span class="op">/</span><span class="fl">4</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>ax1.ylabel <span class="op">=</span> <span class="st">"Capacity [MWh/MW]"</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Cost breakdown</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> <span class="fu">Axis</span>(fig1[<span class="fl">1</span>, <span class="fl">2</span>], title<span class="op">=</span><span class="st">"Annual Investment Cost Breakdown"</span>, aspect<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">hidespines!</span>(ax2)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="fu">hidedecorations!</span>(ax2)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>costs <span class="op">=</span> [results.investment_costs[g] for g <span class="kw">in</span> results_df.component]</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="op">:</span>blue, <span class="op">:</span>green, <span class="op">:</span>orange, <span class="op">:</span>red, <span class="op">:</span>purple, <span class="op">:</span>brown]</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> results_df.component</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create pie chart</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="fu">pie!</span>(ax2, costs, color<span class="op">=</span>colors, radius<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Create legend</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="fu">Legend</span>(fig1[<span class="fl">2</span>, <span class="fl">2</span>], [<span class="fu">PolyElement</span>(color<span class="op">=</span>c) for c <span class="kw">in</span> colors], labels, <span class="st">"Components"</span>, </span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    orientation<span class="op">=:</span>horizontal)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Display figure</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(fig1)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Create operational plots for multi-carrier system</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>fig2 <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1400</span>, <span class="fl">1800</span>))</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Methanol system</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> <span class="fu">Axis</span>(fig2[<span class="fl">1</span>, <span class="fl">1</span>], title<span class="op">=</span><span class="st">"Methanol Production and Demand"</span>)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ω <span class="kw">in</span> <span class="fu">keys</span>(dictScenarios)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Total methanol production</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    total_prod <span class="op">=</span> [<span class="fu">sum</span>(results.operational_variables[<span class="st">"x_out"</span>][g,<span class="st">"methanol"</span>,t,ω] for g <span class="kw">in</span> G) for t <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">168</span>]</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines!</span>(ax1, <span class="fl">1</span><span class="op">:</span><span class="fl">168</span>, total_prod, label<span class="op">=</span><span class="st">"Production - </span><span class="sc">$</span><span class="st">ω")</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="st">    </span>lines<span class="st">!(ax1, 1:168, dictScenarios[ω].demand["</span>methanol<span class="st">"], label="</span>Demand <span class="op">-</span> <span class="op">$</span>ω<span class="st">", linestyle=:dash)</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>ax1.xlabel <span class="op">=</span> <span class="st">"Hour"</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>ax1.ylabel <span class="op">=</span> <span class="st">"Production [t/h]"</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="fu">axislegend</span>(ax1)</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Storage operation</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> <span class="fu">Axis</span>(fig2[<span class="fl">1</span>, <span class="fl">2</span>], title<span class="op">=</span><span class="st">"Storage Energy Level"</span>)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> g <span class="kw">in</span> GS</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ω <span class="kw">in</span> <span class="fu">keys</span>(dictScenarios)</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax2, <span class="fl">1</span><span class="op">:</span><span class="fl">168</span>, [results.operational_variables[<span class="st">"soc"</span>][g,t,ω] for t <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">168</span>], </span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>               label<span class="op">=</span><span class="st">"</span><span class="sc">$</span>g<span class="st"> - </span><span class="sc">$</span><span class="st">ω")</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="st">    </span>end</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>ax2.xlabel <span class="op">=</span> <span class="st">"Hour"</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>ax2.ylabel <span class="op">=</span> <span class="st">"Energy [MWh]"</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="fu">axislegend</span>(ax2)</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Hydrogen flows</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> <span class="fu">Axis</span>(fig2[<span class="fl">2</span>, <span class="fl">1</span>], title<span class="op">=</span><span class="st">"Hydrogen Production and Consumption"</span>)</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ω <span class="kw">in</span> <span class="fu">keys</span>(dictScenarios)</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Hydrogen production (from electrolyzer)</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>    h2_prod <span class="op">=</span> [<span class="fu">sum</span>(results.operational_variables[<span class="st">"x_out"</span>][g,<span class="st">"hydrogen"</span>,t,ω] for g <span class="kw">in</span> G) for t <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">168</span>]</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Hydrogen consumption (by methanol synthesis)</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>    h2_cons <span class="op">=</span> [<span class="fu">sum</span>(results.operational_variables[<span class="st">"x_in"</span>][g,<span class="st">"hydrogen"</span>,t,ω] for g <span class="kw">in</span> G) for t <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">168</span>]</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines!</span>(ax3, <span class="fl">1</span><span class="op">:</span><span class="fl">168</span>, h2_prod, label<span class="op">=</span><span class="st">"Production - </span><span class="sc">$</span><span class="st">ω")</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a><span class="st">    </span>lines<span class="st">!(ax3, 1:168, h2_cons, label="</span>Consumption <span class="op">-</span> <span class="op">$</span>ω<span class="st">", linestyle=:dash)</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>ax3.xlabel <span class="op">=</span> <span class="st">"Hour"</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>ax3.ylabel <span class="op">=</span> <span class="st">"Flow [t/h]"</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a><span class="fu">axislegend</span>(ax3)</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a><span class="co"># CO2 flows</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>ax4 <span class="op">=</span> <span class="fu">Axis</span>(fig2[<span class="fl">2</span>, <span class="fl">2</span>], title<span class="op">=</span><span class="st">"CO2 Supply and Consumption"</span>)</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ω <span class="kw">in</span> <span class="fu">keys</span>(dictScenarios)</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CO2 supply</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>    co2_supply <span class="op">=</span> [<span class="fu">sum</span>(results.operational_variables[<span class="st">"x_out"</span>][g,<span class="st">"CO2"</span>,t,ω] for g <span class="kw">in</span> GSup) for t <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">168</span>]</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CO2 consumption (by methanol synthesis)</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>    co2_cons <span class="op">=</span> [<span class="fu">sum</span>(results.operational_variables[<span class="st">"x_in"</span>][g,<span class="st">"CO2"</span>,t,ω] for g <span class="kw">in</span> G) for t <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">168</span>]</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines!</span>(ax4, <span class="fl">1</span><span class="op">:</span><span class="fl">168</span>, co2_supply, label<span class="op">=</span><span class="st">"Supply - </span><span class="sc">$</span><span class="st">ω")</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a><span class="st">    </span>lines<span class="st">!(ax4, 1:168, co2_cons, label="</span>Consumption <span class="op">-</span> <span class="op">$</span>ω<span class="st">", linestyle=:dash)</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>ax4.xlabel <span class="op">=</span> <span class="st">"Hour"</span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>ax4.ylabel <span class="op">=</span> <span class="st">"Flow [t/h]"</span></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a><span class="fu">axislegend</span>(ax4)</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Technology operation</span></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>ax5 <span class="op">=</span> <span class="fu">Axis</span>(fig2[<span class="fl">3</span>, <span class="fl">1</span>], title<span class="op">=</span><span class="st">"Technology Operation Levels"</span>)</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> g <span class="kw">in</span> GConv</span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ω <span class="kw">in</span> <span class="fu">keys</span>(dictScenarios)</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax5, <span class="fl">1</span><span class="op">:</span><span class="fl">168</span>, [results.operational_variables[<span class="st">"x_total"</span>][g,t,ω] for t <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">168</span>], </span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>               label<span class="op">=</span><span class="st">"</span><span class="sc">$</span>g<span class="st"> - </span><span class="sc">$</span><span class="st">ω")</span></span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a><span class="st">    </span>end</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>ax5.xlabel <span class="op">=</span> <span class="st">"Hour"</span></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>ax5.ylabel <span class="op">=</span> <span class="st">"Activity Level [MW]"</span></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a><span class="fu">axislegend</span>(ax5)</span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable renewable operation</span></span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>ax6 <span class="op">=</span> <span class="fu">Axis</span>(fig2[<span class="fl">3</span>, <span class="fl">2</span>], title<span class="op">=</span><span class="st">"Variable Renewable Generation"</span>)</span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> g <span class="kw">in</span> GVar</span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ω <span class="kw">in</span> <span class="fu">keys</span>(dictScenarios)</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax6, <span class="fl">1</span><span class="op">:</span><span class="fl">168</span>, [results.operational_variables[<span class="st">"x_total"</span>][g,t,ω] for t <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">168</span>], </span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>               label<span class="op">=</span><span class="st">"</span><span class="sc">$</span>g<span class="st"> - </span><span class="sc">$</span><span class="st">ω")</span></span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a><span class="st">    </span>end</span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>ax6.xlabel <span class="op">=</span> <span class="st">"Hour"</span></span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>ax6.ylabel <span class="op">=</span> <span class="st">"Power [MW]"</span></span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a><span class="fu">axislegend</span>(ax6)</span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a><span class="co"># Display figure</span></span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(fig2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="methanol-synthesis-and-carbon-capture-extension" class="level2">
<h2 class="anchored" data-anchor-id="methanol-synthesis-and-carbon-capture-extension">7. Methanol Synthesis and Carbon Capture Extension</h2>
<p>The framework has been successfully extended with:</p>
<ol type="1">
<li><strong>Methanol Synthesis Plant</strong>: Converts hydrogen and CO₂ to methanol</li>
<li><strong>Carbon Capture Unit</strong>: Provides CO₂ supply to the system</li>
</ol>
<p>Let’s analyze the results of this extension:</p>
<div id="14" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze methanol synthesis results</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"Methanol Synthesis Analysis:"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"="</span> <span class="op">*</span> <span class="fl">40</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate average methanol production</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>avg_meoh_prod <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ω <span class="kw">in</span> <span class="fu">keys</span>(dictScenarios)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">168</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        avg_meoh_prod <span class="op">+=</span> <span class="fu">sum</span>(results.operational_variables[<span class="st">"x_out"</span>][g,<span class="st">"methanol"</span>,t,ω] <span class="cf">for</span> g <span class="kw">in</span> G)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>avg_meoh_prod <span class="op">/=</span> (<span class="fu">length</span>(<span class="fu">keys</span>(dictScenarios)) <span class="op">*</span> <span class="fl">168</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"Average Methanol Production: </span><span class="sc">$</span>(<span class="fu">round</span>(avg_meoh_prod, digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> t/h"</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"Methanol Synthesis Capacity: </span><span class="sc">$</span>(<span class="fu">round</span>(results.P_nom[<span class="st">"meoh_synth"</span>], digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> MW"</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"Investment Cost: </span><span class="sc">$</span>(<span class="fu">round</span>(results.investment_costs[<span class="st">"meoh_synth"</span>], digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> EUR/year"</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze hydrogen flows</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Hydrogen Flow Analysis:"</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"="</span> <span class="op">*</span> <span class="fl">40</span>)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate average hydrogen production and consumption</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>avg_h2_prod <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>avg_h2_cons <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ω <span class="kw">in</span> <span class="fu">keys</span>(dictScenarios)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">168</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        avg_h2_prod <span class="op">+=</span> <span class="fu">sum</span>(results.operational_variables[<span class="st">"x_out"</span>][g,<span class="st">"hydrogen"</span>,t,ω] <span class="cf">for</span> g <span class="kw">in</span> G)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        avg_h2_cons <span class="op">+=</span> <span class="fu">sum</span>(results.operational_variables[<span class="st">"x_in"</span>][g,<span class="st">"hydrogen"</span>,t,ω] <span class="cf">for</span> g <span class="kw">in</span> G)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>avg_h2_prod <span class="op">/=</span> (<span class="fu">length</span>(<span class="fu">keys</span>(dictScenarios)) <span class="op">*</span> <span class="fl">168</span>)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>avg_h2_cons <span class="op">/=</span> (<span class="fu">length</span>(<span class="fu">keys</span>(dictScenarios)) <span class="op">*</span> <span class="fl">168</span>)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"Average Hydrogen Production: </span><span class="sc">$</span>(<span class="fu">round</span>(avg_h2_prod, digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> t/h"</span>)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"Average Hydrogen Consumption: </span><span class="sc">$</span>(<span class="fu">round</span>(avg_h2_cons, digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> t/h"</span>)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"Electrolyzer Capacity: </span><span class="sc">$</span>(<span class="fu">round</span>(results.P_nom[<span class="st">"electrolyzer"</span>], digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> MW"</span>)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze CO2 flows</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">CO2 Flow Analysis:"</span>)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"="</span> <span class="op">*</span> <span class="fl">40</span>)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>avg_co2_supply <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>avg_co2_cons <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ω <span class="kw">in</span> <span class="fu">keys</span>(dictScenarios)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">168</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>        avg_co2_supply <span class="op">+=</span> <span class="fu">sum</span>(results.operational_variables[<span class="st">"x_out"</span>][g,<span class="st">"CO2"</span>,t,ω] <span class="cf">for</span> g <span class="kw">in</span> GSup)</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>        avg_co2_cons <span class="op">+=</span> <span class="fu">sum</span>(results.operational_variables[<span class="st">"x_in"</span>][g,<span class="st">"CO2"</span>,t,ω] <span class="cf">for</span> g <span class="kw">in</span> G)</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>avg_co2_supply <span class="op">/=</span> (<span class="fu">length</span>(<span class="fu">keys</span>(dictScenarios)) <span class="op">*</span> <span class="fl">168</span>)</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>avg_co2_cons <span class="op">/=</span> (<span class="fu">length</span>(<span class="fu">keys</span>(dictScenarios)) <span class="op">*</span> <span class="fl">168</span>)</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"Average CO2 Supply: </span><span class="sc">$</span>(<span class="fu">round</span>(avg_co2_supply, digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> t/h"</span>)</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"Average CO2 Consumption: </span><span class="sc">$</span>(<span class="fu">round</span>(avg_co2_cons, digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> t/h"</span>)</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"CO2 Supply Capacity: </span><span class="sc">$</span>(<span class="fu">round</span>(dictSupply[<span class="st">"CO2"</span>].outflow_nom, digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> t/h"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sensitivity-analysis" class="level2">
<h2 class="anchored" data-anchor-id="sensitivity-analysis">8. Sensitivity Analysis</h2>
<p>Let’s analyze how the optimal solution changes with different maximum budgets:</p>
<div id="16" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test different budgets</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>budgets <span class="op">=</span> [<span class="fl">25_000_000</span>, <span class="fl">50_000_000</span>, <span class="fl">75_000_000</span>, <span class="fl">100_000_000</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>results_by_budget <span class="op">=</span> <span class="fu">Dict</span>()</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> budget <span class="kw">in</span> budgets</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    results_by_budget[budget] <span class="op">=</span> <span class="fu">solve_mes_framework</span>(dictGS, dictGVar, dictGConv, dictGSup, dictScenarios, dictSupply, budget)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create figure</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>fig3 <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1200</span>, <span class="fl">800</span>))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort budgets and get corresponding results</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>sorted_budgets <span class="op">=</span> <span class="fu">sort</span>(budgets)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>sorted_results <span class="op">=</span> [results_by_budget[b] for b <span class="kw">in</span> sorted_budgets]</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Component sizes vs budget</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> <span class="fu">Axis</span>(fig3[<span class="fl">1</span>, <span class="fl">1</span>], title<span class="op">=</span><span class="st">"Component Sizes vs Budget"</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> g <span class="kw">in</span> G</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> g <span class="kw">in</span> results.P_nom</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax1, sorted_budgets, [r.P_nom[g] for r <span class="kw">in</span> sorted_results], label<span class="op">=</span>g)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>ax1.xlabel <span class="op">=</span> <span class="st">"Maximum Budget [EUR]"</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>ax1.ylabel <span class="op">=</span> <span class="st">"Capacity [MWh or MW]"</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="fu">axislegend</span>(ax1)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Costs vs budget</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> <span class="fu">Axis</span>(fig3[<span class="fl">1</span>, <span class="fl">2</span>], title<span class="op">=</span><span class="st">"Costs vs Budget"</span>)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="fu">lines!</span>(ax2, sorted_budgets, [r.total_cost for r <span class="kw">in</span> sorted_results], label<span class="op">=</span><span class="st">"Total Annual Cost"</span>)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Add investment costs for each technology type</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> g <span class="kw">in</span> G</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> g <span class="kw">in</span> results.investment_costs</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax2, sorted_budgets, [r.investment_costs[g] for r <span class="kw">in</span> sorted_results], label<span class="op">=</span>g)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>ax2.xlabel <span class="op">=</span> <span class="st">"Maximum Budget [EUR]"</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>ax2.ylabel <span class="op">=</span> <span class="st">"Annual Cost [EUR/year]"</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="fu">axislegend</span>(ax2)</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Display figure</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(fig3)</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Print key findings</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Key Findings from Budget Sensitivity Analysis:"</span>)</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"1. Impact on Component Sizes:"</span>)</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> g <span class="kw">in</span> G</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> g <span class="kw">in</span> results.P_nom</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>        <span class="fu">println</span>(<span class="st">"   - </span><span class="sc">$</span>g<span class="st"> capacity changes from </span><span class="sc">$</span>(<span class="fu">round</span>(sorted_results[<span class="fl">1</span>].P_nom[g], digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> to </span><span class="sc">$</span>(<span class="fu">round</span>(sorted_results[<span class="kw">end</span>].P_nom[g], digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> MW"</span>)</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">2. Impact on Costs:"</span>)</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"   - Total cost changes from </span><span class="sc">$</span>(<span class="fu">round</span>(sorted_results[<span class="fl">1</span>].total_cost, digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> to </span><span class="sc">$</span>(<span class="fu">round</span>(sorted_results[<span class="kw">end</span>].total_cost, digits<span class="op">=</span><span class="fl">2</span>))<span class="st"> EUR/year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">9. Conclusion</h2>
<p>This tutorial has successfully demonstrated the implementation of a <strong>general multi-energy system optimization framework</strong> with the following key achievements:</p>
<section id="framework-implementation" class="level3">
<h3 class="anchored" data-anchor-id="framework-implementation">Framework Implementation</h3>
<ul>
<li><strong>Technology-agnostic design</strong>: The framework can handle any combination of energy carriers and conversion technologies</li>
<li><strong>Flexible data structure</strong>: Uses carrier-specific demand, capacity factors, and market prices</li>
<li><strong>Comprehensive constraints</strong>: Implements all framework constraints including energy conversion, storage dynamics, and energy balances</li>
</ul>
</section>
<section id="system-extension" class="level3">
<h3 class="anchored" data-anchor-id="system-extension">System Extension</h3>
<ul>
<li><strong>Methanol synthesis</strong>: Successfully integrated hydrogen and CO₂ conversion to methanol</li>
<li><strong>Carbon capture</strong>: Added CO₂ supply as a new energy carrier</li>
<li><strong>Multi-carrier optimization</strong>: Optimized across electricity, hydrogen, methanol, and CO₂ simultaneously</li>
</ul>
</section>
<section id="key-benefits" class="level3">
<h3 class="anchored" data-anchor-id="key-benefits">Key Benefits</h3>
<ol type="1">
<li><strong>Scalability</strong>: Easy to add new technologies and carriers by updating data files</li>
<li><strong>Robustness</strong>: Stochastic formulation handles uncertainty in renewable generation and demand</li>
<li><strong>Comprehensive</strong>: Considers investment and operational decisions simultaneously</li>
<li><strong>Flexible</strong>: Framework can be adapted to various energy system applications</li>
</ol>
</section>
<section id="practical-applications" class="level3">
<h3 class="anchored" data-anchor-id="practical-applications">Practical Applications</h3>
<p>The framework can be applied to: - Industrial energy systems - Microgrid design - Power-to-X facilities - Multi-energy hubs - Renewable energy integration</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The general framework provides a powerful foundation for multi-energy system optimization. By changing only the data files (sets and parameters), the same model can be applied to different energy system configurations, making it a versatile tool for energy system planning and optimization.</p>
</div>
</div>
</section>
</section>
</section>
<section id="solutions" class="level1">
<h1>Solutions</h1>
<p>You will likely find solutions to most exercises online. However, I strongly encourage you to work on these exercises independently without searching explicitly for the exact answers to the exercises. Understanding someone else’s solution is very different from developing your own. Use the lecture notes and try to solve the exercises on your own. This approach will significantly enhance your learning and problem-solving skills.</p>
<p>Remember, the goal is not just to complete the exercises, but to understand the concepts and improve your programming abilities. If you encounter difficulties, review the lecture materials, experiment with different approaches, and don’t hesitate to ask for clarification during class discussions.</p>
<p>Later, you will find the solutions to these exercises online in the associated GitHub repository, but we will also quickly go over them in next week’s tutorial. To access the solutions, click on the Github button on the lower right and search for the folder with today’s lecture and tutorial. Alternatively, you can ask ChatGPT or Claude to explain them to you. But please remember, the goal is not just to complete the exercises, but to understand the concepts and improve your programming abilities.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/TobiasCors\.github\.io\/Energy-System-Optimization");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Energy System Optimization with Julia, Tobias Cors<br>CC BY-NC-SA 4.0</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TobiasCors/Energy-System-Optimization/edit/main/part-11/tutorial-framework.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TobiasCors/Energy-System-Optimization/blob/main/part-11/tutorial-framework.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/TobiasCors/Energy-System-Optimization/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TobiasCors/Energy-System-Optimization">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/tobias-cors">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>